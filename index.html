<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check-in-out</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        window.onload = function () {
            initializeLiff(),getUserProfile();
        };
        async function initializeLiff() {
            await liff.init({ liffId: '2002290922-O7vx3Jj7' }); // Replace with your LIFF ID
            if (liff.isLoggedIn()) {
                getUserProfile();
            } else {
                liff.login();
            }
        }
        async function getUserProfile() {
            try {
                const profile = await liff.getProfile();
                document.getElementById('userId').value = profile.userId;
                document.getElementById('displayName').value = profile.displayName;
                // Trigger search when user ID is retrieved
                searchData();
            } catch (error) {
                console.error('Error getting profile data:', error);
            }
        }
    </script>
</head>

<body>
    <div class="container top-content">
        <div style="color: white; font-weight: bold;font-size: 1.2rem;" class="p-2"><span>สวัสดี</span>
            <input type="text" id="displayName" name="displayName"
                style="color:#ffffff;border: none; width:65%; background-color: rgba(255, 255, 255, 0);">
        </div>
        <div class="banner mb-3">
            <div class="imgband"></div>
            <div class="daytime">
                <div id="date"></div>
                <div id="time"></div>
                <input type="date" id="todayInput" name="todayInput" readonly
                    style="position: absolute; left: -9999px;">
                <input type="time" id="currentTime" name="currentTime" style="display: none;">
            </div>
        </div>
    </div>
    <div class="container buttom-content">

        <div id="step1">
            <div class="state p-2">
                <div class="input-icons ">
                    <span class="material-symbols-outlined"> co_present </span>
                    <input type="text" class="input-field" id="columnBData" placeholder="ชื่อ - สกุล" name="columnBData"
                        required>
                </div>
                <div class="input-icons ">
                    <span class="material-symbols-outlined">pin</span>
                    <input type="text" class="input-field" id="roleInput" placeholder="รหัส พนักงาน" name="roleInput"
                        required>
                </div>
                <div class="input-icons ">
                    <span class="material-symbols-outlined"> editor_choice </span>
                    <input type="text" class="input-field" id="columnDData" placeholder="ตำแหน่ง" name="columnDData"
                        required>
                </div>
                <div class="switch-field mt-4 mb-4">
                    <input type="radio" id="radio-three" name="switch-jop" value="เข้างาน" />
                    <label for="radio-three">เข้างาน</label>
                    <input type="radio" id="radio-four" name="switch-jop" value="ระหว่างวัน" />
                    <label for="radio-four">ระหว่างวัน</label>
                    <input type="radio" id="radio-five" name="switch-jop" value="ออกงาน" />
                    <label for="radio-five">ออกงาน</label>
                </div>
                <!-- Add a hidden input field to store the selected value -->
                <input type="hidden" id="jobInput" name="jobInput" required>
                <textarea class="form-control w-full" placeholder="Note" id="noteInput"></textarea><br>
            </div>
            <div class="footerbar">
                <button class="btn btn-blue mt-3" onclick="nextStep()">ถัดไป</button>
            </div>
            <table id="data-table" style="color: black; position: absolute;z-index: -9999;">
                <input type="text" id="userId" name="userId" oninput="searchData()"
                    style="color:#fff; border: 1px solid #fff; position: absolute; z-index: -99;" />
                <input type="text" id="columnAData" name="columnAData" style="display: none;" />
            </table>
        </div>
        <div id="step2" style="display: none;text-align: center;">
            <div class="photo" style="max-width:100%; width:640;height:420;">
                <center><video id="camera-preview" width="70%" height="auto" autoplay playsinline
                        poster="https://upload.wikimedia.org/wikipedia/commons/thumb/6/65/No-Image-Placeholder.svg/330px-No-Image-Placeholder.svg.png?20200912122019"></video>
                </center>
                <br>
                <img id="preview" width="70%" height="auto" alt="" required>
                <div class="mb-4">
                    <button class="btn btn-yellow m-2" id="start-camera-btn">เริ่มเปิดกล้อง</button>
                    <button class="btn btn-green m-2" id="capture-btn" disabled>ถ่ายรูป</button>
                </div>
            </div>

            <div class="input-group mb-4">
                <button class="btn btn-gray m-2" onclick="prevStep()">กลับ</button>
                <button class="btn btn-blue m-2" onclick="checkPictureAndNextStep()">ถัดไป</button>
            </div>
        </div>
        <div id="step3" style="display: none;text-align: center;">
            <div class="submit">
                <div class="p-2 mb-2">
                    <button type="button" onclick="getLocation()"
                        class="btn btn-map">กดเพื่อยืนยันที่อยู่ของคุณ</button>
                </div>
                <div id="locationInfo" name="locationInfo">
                    <p id="latitude">Latitude: </p>
                    <p id="longitude">Longitude: </p>
                </div>
                <p id="fullAddress">สถานที่</p>
                <input type="hidden" id="latitudeInput" name="latitudeInput">
                <input type="hidden" id="longitudeInput" name="longitudeInput">
                <input type="hidden" id="fullAddressInput" name="fullAddressInput" required>
            </div>
            <br>
            <!-- Add iframe for displaying Google Maps -->
            <iframe id="mapIframe" class="p-2" width="100%" height="240" frameborder="0" style="border:0;"
                allowfullscreen="" aria-hidden="false" tabindex="0"></iframe>
            <div class="input-group mt-4">
                <button class="btn btn-gray " onclick="prevStep()">กลับ</button>
                <button id="submitButton" class="btn btn-red" onclick="submitForm()">บันทึกข้อมูล</button>
            </div>
        </div>
    </div>
    </div>
    <script src="./script.js"></script>
</body>

</html>
